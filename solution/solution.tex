\documentclass[12pt,a4paper]{article}
\usepackage[unicode,colorlinks=true]{hyperref}
\usepackage[czech]{babel}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage{graphicx}
\textwidth 16cm \textheight 24.6cm
\topmargin -1.3cm
\oddsidemargin 0cm
\usepackage{url}
\usepackage{fancyhdr}
\usepackage{amsmath}
\usepackage{empheq}

\begin{document}

\pagestyle{fancy}     % zapne obyčejné číslování
\setcounter{page}{1}  % nastaví čítač stránek znovu od jedné
\pagenumbering{arabic} % číslování arabskymi číslicemi

\fancyhead[L]{Autorské řešení kvalifikační úlohy z~logiky}
\fancyhead[R]{logika@ntrophy.cz}

\title{N-trophy$^9$\\Autorské řešení kvalifikační úlohy z~logiky}
\date{\today}
\author{logika@ntrophy.cz}
\maketitle

\setlength{\parindent}{0cm}
\setlength{\parskip}{3mm plus2pt minus2pt}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
Možná nějaké úvodní kecičky.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{Řešení úloh v rovině}
\subsection*{Úroveň 1}

V~této úrovni byly 3 incidenty umístěny do vrcholů rovnostranného trojúhelníku.
Vzdálenostní funkce vypadala takto:
$$E(N) = \frac{|I_1N|^2 + |I_2N|^2 + |I_3N|^2}{3}.$$

Optimální polohou pro tuto vzdálenostní funkci je těžiště trojúhelníka.
V~následujícím textu budeme argumentovat, proč tomu tak je.

Nejprve proveďme nejuniverzálnější úpravu: zjednodušme výraz tak, že z~něj
odstraníme konstanty. To můžeme udělat vždy, protože nás nezajímá konkrétní
hodnota vzdálenostní funkce, ale pouze místo, ve kterém se realizuje optimum.
Dostáváme jednodušší výraz:

$$E(N) = |I_1N|^2 + |I_2N|^2 + |I_3N|^2.$$

Tuto úpravu můžeme udělat v~kterékoliv úrovni, proto ji v~dalším textu budeme
dělat automaticky.

Hledáme tedy bod, který \uv{minimalizuje kvadrát vzdálenosti}. Takový bod bude
nejspíš někde uvnitř trojúhelníka, hledáme tedy jakýsi \uv{střed}. Otázka zní,
jak tento bod najít. V~této úrovni jste měli hodně pokusů, takže jste mohli
prostě zkoušet různé pozice bodů. Možná jste se dostali k~docela dobrému
výsledku, vyvstává však otázka, jestli je vaše řešení skutečně to nejlepší.
Tuto otázku jste mohli zodpovědět analytickým řešením úlohy.

Nejprve si rozepišme funkci $E$ dle Euklidovské vzdálenosti:

\begin{align}
E(N) &= \left(\sqrt{(x_n-x_1)^2 + (y_n - y_1)^2}\right)^2 +
	\left(\sqrt{(x_n-x_2)^2 + (y_n - y_2)^2}\right)^2 + \nonumber \\
	&\hspace{1em} + \left(\sqrt{(x_n-x_3)^2 + (y_n - y_3)^2}\right)^2 \nonumber \\
E(N) &= (x_n-x_1)^2 + (y_n - y_1)^2 +
	(x_n-x_2)^2 + (y_n - y_2)^2 +
	(x_n-x_3)^2 + (y_n - y_3)^2 \nonumber.
\end{align}

Vidíme, že pro výpočet hodnoty $E$ je možné spočítat nezávisle hodnoty souřadnic
$x$ a $y$. Rozdělíme tedy výpočet na hledání minim dvou funkcí:

\begin{align}
E_x(N) &= (x_n-x_1)^2 + (x_n-x_2)^2 + (x_n-x_3)^2 \nonumber, \\
E_y(N) &= (y_n-y_1)^2 + (y_n-y_2)^2 + (y_n-y_3)^2 \nonumber.
\end{align}

Chceme minimalizovat hodnotu funkce $E_x$. Ze školy možná víte, že minimum
funkce se hledá pomocí derivací\footnote{Pokud neumíte derivovat, mohli jste
využít například stránku \url{wolframalpha.com}.}. Pro minimum funkce musí
platit, že je v~něm derivace rovna nule:

\begin{align}
0 &= \frac{dE}{dN} \nonumber \\
0 &= 2(x_n-x_1) + 2(x_n-x_2) + 2(x_n-x_3) \nonumber \\
0 &= (x_n-x_1) + (x_n-x_2) + (x_n-x_3) \nonumber \\
0 &= 3x_n - (x_1 + x_2 + x_3) \nonumber \\
3x_n &= (x_1 + x_2 + x_3) \nonumber \\
x_n &= \frac{x_1 + x_2 + x_3}{3} \nonumber
\end{align}

Z~výpočtu tedy vychází, že pozice nemocnice je přesně v~aritmetickém průměru
všech bodů\footnote{Pokud bychom měli být úplně matematicky korektní, je třeba
ještě argumentovat, že optimum je pouze jediné a~že se jedná skutečně o~minimum.
To plyne z~tvaru \textit{Hessiánu} gradientu.}. Hodnotu $y_n$ lze vypočítat
úplně stejným postupem.

Všimněte si, že získaný výsledek přesně odpovídá definici těžiště trojúhelníka.
Můžeme pokračovat dosazením konkrétních hodnot ze zadání:

\begin{align}
x_n &= \frac{0 + 400 + 200}{3}, y_n = \frac{0 + 0 - 387.3}{3} \nonumber \\
x_n &= 200, y_n = -129.1  \nonumber.
\end{align}

Nemocnici tedy umístíme na souřadnice $X=200$, $Y=-129.1$. Hodnota vzdálenostní
funkce pro tuto pozici nemocnice je $60000.29$.

\subsection*{Úroveň 2}
V~druhé úrovni bylo potřeba dát si pozor na změnu vzdálenostní funkce, ta vypadala takto:
$$E(N) = \frac{|AN| + |BN| + |CN|}{3}.$$

Klíčové je uvědomit si, že zadání je symetrické. To nás může přivést k úvaze, že optimální poloha nemocnice je na ose rovnoramenného trojúhelníka,
ale toto tvrzení by bylo dobré nějak podložit. Nechť tedy máme stanici $N$ kdekoli na ose $O$ a~stanici $N'$ ve stejné výšce, ale ne na ose. Pak stanice $N$ leží na elipse zadané bodem $N$ a~ohnisky $A,B$.
Připomeňme si, že elipsa je množina všech bodů, které mají stejný součet vzdáleností od dvou ohnisek (v~našem případě bodů $A$ a~$B$). Protože elipsa je symetrická podle osy $O$,
musí být v~místě průniku s osou $O$ její nejvyšší bod. Zejména tedy bod $N'$ se vždy bude nacházet nad elipsou a~to znamená, že on sám má větší součet vzdáleností od bodů $A$ a $B$ než bod $N$.
Zároveň je z~trojúhelníkové nerovnosti zřejmé, že i~vzdálenost $|N'C|$ je větší než vzdálenost $|NC|$.

Nyní je potřeba určit vertikální souřadnici bodu $N$.
Označme si délku základny trojúhelníka $ABC$ jako $2a$, jeho výšku $v$ a~výšku trojúhelníka $ABN$ označme $b$. Dosazením do vzorce získáváme:
$$E(N) = \frac{|AN| + |BN| + |CN|}{3} = \frac{\sqrt{a^2+b^2} + \sqrt{a^2+b^2} + (v - b)}{3}.$$
Podobně, jako v předchozí úloze, máme nyní funkci v proměnné $b$, kterou můžeme zderivovat a získat její minimum.
$$\frac{d E(b)}{db} = \frac{d}{db}\frac{2 \sqrt{a^2+b^2} + (v - b)}{3} = \frac{2b}{3 \sqrt{a^2+b^2}} - \frac{1}{3}$$

\begin{align}
\frac{2b}{3 \sqrt{a^2+b^2}} - \frac{1}{3} &= 0 \nonumber \\
\frac{2b}{\sqrt{a^2+b^2}} &= 1 \nonumber \\
2b &= \sqrt{a^2+b^2} \nonumber \\
4b^2 &= a^2 + b^2 \nonumber \\
3b^2 &= a^2 \nonumber \\
\sqrt{3}b &= a \nonumber
\end{align}

Získali jsme tedy výsledek, že $a = \sqrt{3}b$. To ovšem dle pythagorovy věty znamená, že $|AN|=2b$. Pokud nyní překlopíme celý trojúhelník $ABN$ podle horizontální osy,
získáme čtuřúhelník, jehož všechny strany mají délku $2b$ a~i~jeho uhlopříčka má délku $2b$. Proto se jedná o~dva rovnostranné trojúhelníky přiložené k~sobě, a tedy úhel u~vrcholu $N$ je $120^\circ$.
Nezávisle na poloze bodu $C$ proto vždy hledáme takový bod $N$ na ose $O$, že velikost úhlu $\angle ANB$ je $120^\circ$

Dosazením konkrétních hodnot ze zadání dostáváme $a = 400$, $b = \frac{200}{\sqrt{3}}
\doteq 115.47$, Nemocnici tedy umístíme na souřadnice $X = 200$, $Y = -115.47$.
Hodnota vzdálenostní funkce pro tyto souřadnice je $244.57$.

Pro zajímavost ještě ukažme správnost výsledku i~jinou cestou, při které nemusíme znát derivace. Mějme tedy $b$ takové, že platí $a = \sqrt{3}b$ a~předpokládejme, že se bod $N$ nachází v~jiné výšce než $b$.
Označme ji $b+k$ pro libovolné $k$. Ukážeme si, že pro tuto hodnotu výšky bude funkce vždy větší než pro hodnotu $b$. Tedy ukážeme $E(b) \leq E(b+k)$.

\begin{align}
	E(b) &\leq E(b+k) \nonumber \\
	\frac{2 \sqrt{a^2+b^2} + (v - b)}{3} &\leq \frac{2 \sqrt{a^2+(b+k)^2} + (v - (b+k))}{3} \nonumber \\
	2 \sqrt{a^2+b^2} + (v - b) &\leq 2 \sqrt{a^2+b^2+2bk+k^2} + (v - b) - k) \nonumber \\
	2 \sqrt{a^2+b^2} &\leq 2 \sqrt{a^2+b^2+2bk+k^2} - k) \nonumber
\end{align}
	Dále dosadíme za $a$
\begin{align}
	2 \sqrt{(\sqrt{3}b)^2+b^2} &\leq 2 \sqrt{(\sqrt{3}b)^2+b^2+2bk+k^2} - k) \nonumber \\
	4b + k &\leq 2 \sqrt{4b^2+2bk+k^2}) \nonumber \\
	16b^2 + 8bk + k^2 &\leq 16b^2+8bk+4k^2 \nonumber \\
	0 &\leq 3k^2 \nonumber
\end{align}
Rovnost tedy nastává práve pro volbu $k=0$.


\subsection*{Úroveň 3}
V~této úrovni bylo potřeba umístit pouze jedinou nemocnici se stejným kritériem
jako v úrovni 1. Řešení je proto v~podstatě stejné jako v~první úrovni, pouze
bylo potřeba zpracovat více dat. S~výhodou se tak dalo využít například Excelu,
nebo jednoduchého programu ve vašem oblíbeném programovacím jazyce.

Na webu \url{https://logika.ntrophy.cz} je k~dispozici příklad programu
v~jazyce Python, kterému stačí argumentem předat jméno csv souboru s~polohami
incidentů a~on vypočte optimální polohu nemocnice.

Výsledné řešení je $X=-3.06$, $Y=-39.85$. Hodnota vzdálenostní funkce pro tuto
pozici nemocnice je $167492.24$.

\subsection*{Úroveň 4}
Tato úroveň se opět podobá úrovni 3, ovšem bylo potřeba umístit více nemocnic.
Více nemocnic úlohu hodně komplikuje, avšak bylo možné si všimnout, že
incidenty jsou rozděleny do shluků (měst), takže je stačilo správně rozdělit do
několika skupin a~každou skupinu vyřešit dle postupu v~úrovni 3. Rozdělení
incidentů do měst jsme dělali ručně, proto níže uvedená hodnota nemusí být
skutečným optimem. Měla by ale být poměrně blízko optima :).

\begin{figure}[ht]
\centering
\includegraphics[width=0.5\textwidth]{level4.pdf}
\caption{Rozdělení incidentů do měst ve 4. úrovni.}
\end{figure}

Souřadnice nemocnic:
\begin{verbatim}
-349.93,339.53
360.53,328.13
181.73,-390.27
-369.38,-178.00
-66.00,-291.00
358.24,-270.24
-62.46,-36.46
127.62,55.00
-144.36,340.09
\end{verbatim}

Hodnota vzdálenostní funkce pro tyto souřadnice je $6208.63$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{Řešení úloh na mapě silnic}
\subsection*{Úroveň 5, 6}
Nejdříve si představme, že všechny body událostí jsou umístěny někde na přímce. Když umístíme nemocnici kamkoli na tuto přímku, získáme nějakou hodnotu vzdálenostní funkce.
Nyní se tuto hodnotu pokusíme optimalizovat. Pozice nemocnice dělí přímku na dvě poloviny, a tedy rozděluje i pozice incidentů na skupinu vlevo a skupinu vpravo.
Nyní předpokládejme, že například ve skupině vlevo se nachází více incidentu než vpravo. Pak posun o malý kousek vlevo zmenší hodnotu vzdálenostní funkce za každý incident vlevo a zvětší její hodnotu za každý incident vpravo.
Protože je ovšem incidentů vlevo více než vpravo, celková změna bude záporná. Proto takto můžeme posouvat stanici až do místa, kde bude množina vlevo i vpravo stejně velká.
V tomto bodě je hodnot a vzdálenostní funkce určitě minimální.

Podobnou úvaho ovšem můžeme provést i pro síť silnic. Pokud se totiž nacházíme s nemocnicí na nějaké cestě, tak rozdělí celou síť na dvě poloviny. Nemocnici posuneme tím směrem, kde se nachází více bodů.
Tento postup nás vždy dovede no optimální pozice pro nemocnici.

\subsection*{Úroveň 7}
V této úrovni šlo aplikovat naprosto stejný postup, jako v úrovni 5 a 6. Stačilo si uvědomit, že úvaha nezávisí na délce spojnic. Posunout se směrem k většímu počtu vrcholů se nám vyplatí vždy pro libovolně dlouhou spojnici dvou incidentů.

\subsection*{Úroveň 8}
V 8. úrovni již bylo potřeba řešení z úrovně 7 trochu poupravit. Váhy jednotlivých incidentů nabourávají naši úvahu o přibližování se té straně, na které se nachází více incidentů.
Ta lze však jednoduše upravit tak, že si například místo jediného incidentu o velikosti pět představím pět incidentů o velikosti jedna. Takto pouze při rozhodování, na kterou stranu silnice půjdeme, budeme přihlížet také k váze jednotlivých incidentů a místo počtu incidentů na každé straně budeme počítat součet jejich vah.

\subsection*{Úroveň 9, 10}
Podobně jako v úrovni 4 hlavní myšlenkou úrovně bylo opět rozdělit incidenty do tří sítí, které se následně řešily postupem z předchozích úrovní. V úrovni 10 mělo být ovšem umístěno tolik nemocnic, že optimální rozdělení na podsítě téměř nebylo možné pouze ručně. S výhodou se tak dalo využít dynamického programování pro získání optimální polohy. Rozumně blízko optimu se šlo ovšem samozřejmě přiblížit i pouhým zkoušením rozdělení na podsítě.

\end{document}
